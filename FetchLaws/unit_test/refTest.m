% clc
% clear
% close all

%% --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% Author: Una Schneck (schneck.una@gmail.com)
% 
% This code performs unit testing for the ref variables in the umwm model, valid for:
%
%                   windspeeds = 0.4:1:3.3
%                   m = 31                                                                    
%                   n = 15                                                                  
%                   rho_liquid = 465
%                   nu_liquid = 0.0031/1e4
%                   bathy_map = 100.*ones(m,n)
%
% If you want to unit test for different parameters, re-run UMWM_Titan_FetchLaws and put resulting .mat files in umwm_old folder under unit_test folder
%
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% External function requirements:
%   (1) none
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% Code produces:
%   (1) List of passed/failed tests
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% Aprox time to run: < 1 minute 
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% ===========================================================================================================================================================================================================================
% ===========================================================================================================================================================================================================================

% location of .mat files for testing
addpath('C:\Users\schne\OneDrive\Desktop\Main\Work\MIT\Github_Repos\umwm_titan\FetchLaws\unit_test\umwm_mat\umwm_old')
addpath('C:\Users\schne\OneDrive\Desktop\Main\Work\MIT\Github_Repos\umwm_titan\FetchLaws\unit_test\umwm_mat\umwm_new')
 
% ===========================================================================================================================================================================================================================
% -- check that grid size is same 
% ===========================================================================================================================================================================================================================
%% Test: m
% m: number of gridpoints in x-direction 
load('Old_1_ref.mat','m'); om = m;
load('New_Reference.mat','m'); nm = m;
assert(om==nm,'m-dimension for original model has changed. Need to re-run original model for unit testing')
%% Test: n
% n: number of gridpoints in y-direction
load('Old_1_ref.mat','n'); on = n;
load('New_Reference.mat','n'); nn = n;
assert(on==nn,'n-dimension for original model has changed. Need to re-run original model for unit testing')


% ===========================================================================================================================================================================================================================
% -- checking D is the same 
% ===========================================================================================================================================================================================================================
%% Test: D
load('Old_1_ref.mat','D'); oD = D;
load('New_Reference.mat','D'); nD = D;

clearvars D

% for o = 1:25
%     for p = 1:287 
%     subplot(1,2,1)
%     surf(xplot',yplot',nD(:,:,o,p),'EdgeColor','k')
%     colormap(jet(256));
%     title('Original')
%     subplot(1,2,2)
%     surf(xplot',yplot',nD(:,:,o,p),'EdgeColor','k')
%     title('New')
%     sgtitle("o "+o+"p "+p)
%     colormap(jet(256));
%     drawnow;
%     pause(0.1)
%     end
% end

problem = 0;
for o = 1:25
    for p = 1:287
        A = oD(:,:,o,p);
        B = nD(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end
        %surf(xplot',yplot',abs(nD(:,:,o,p)-oD(:,:,o,p)))
        %title("o "+o+"p "+p)
        %drawnow;
        %pause(0.1)
    end
end


assert(problem==0,'Depth Test: FAIL')



% ===========================================================================================================================================================================================================================
% -- checking dwn is the same 
% ===========================================================================================================================================================================================================================
%% Test: dwn

load('Old_1_ref.mat','dwn'); odwn = dwn;
load('New_Reference.mat','dwn'); ndwn = dwn;

clearvars dwn

problem = 0;
for o = 1:25
    for p = 1:287
        A = odwn(:,:,o,p);
        B = ndwn(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end
        %surf(xplot',yplot',abs(ndwn(:,:,o,p)-odwn(:,:,o,p)))
        %title("o "+o+"p "+p)
        %drawnow;
        %pause(0.1)
    end
end

assert(problem==0,'dwn Test: FAIL')




% ===========================================================================================================================================================================================================================
% --- checking if wn is the same  
% ===========================================================================================================================================================================================================================
%% Test: wn
load('Old_1_ref.mat','wn'); own = wn;
load('New_Reference.mat','wn'); nwn = wn;

clearvars wn

problem = 0;
for o = 1:25
    for p = 1:287
        A = own(:,:,o,p);
        B = nwn(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end
%         surf(xplot',yplot',abs(nwn(:,:,o,p)-own(:,:,o,p)))
%         title("o "+o+"p "+p)
%         drawnow;
%         pause(0.1)
    end
end


assert(problem==0,'wn Test: FAIL')



% ===========================================================================================================================================================================================================================
% -- checking if Cg is the same 
% ===========================================================================================================================================================================================================================
%% Test: Cg
load('Old_1_ref.mat','Cg'); ocg = Cg;
load('New_Reference.mat','Cg'); ncg = Cg;

clearvars Cg

problem = 0;
for o = 1:25
    for p = 1:287
        A = ocg(:,:,o,p);
        B = ncg(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end
    end
end


assert(problem==0,'Cg Test: FAIL')


% ===========================================================================================================================================================================================================================
% -- checking if c is the same 
% ===========================================================================================================================================================================================================================
%% Test: c
load('Old_1_ref.mat','c'); oc = c;
load('New_Reference.mat','c'); nc = c;

clearvars c

problem = 0;
for o = 1:25
    for p = 1:287
        A = oc(:,:,o,p);
        B = nc(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end

    end
end


assert(problem==0,'c Test: FAIL')


% ===========================================================================================================================================================================================================================
% -- checking if delx is the same 
% ===========================================================================================================================================================================================================================
%% Test: delx
load('Old_1_ref.mat','delx'); odelx = delx;
load('New_Reference.mat','delx'); ndelx = delx;

clearvars delx

problem = 0;
for o = 1:25
    for p = 1:287
        A = odelx(:,:,o,p);
        B = ndelx(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end

    end
end

assert(problem==0,'delx Test: FAIL')



% ===========================================================================================================================================================================================================================
% -- checking if dely is the same 
% ===========================================================================================================================================================================================================================
%% Test: dely
load('Old_1_ref.mat','dely'); odely = dely;
load('New_Reference.mat','dely'); ndely = dely;

clearvars dely

problem = 0;
for o = 1:25
    for p = 1:287
        A = odely(:,:,o,p);
        B = ndely(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end

    end
end


assert(problem==0,'dely Test: FAIL')



% ===========================================================================================================================================================================================================================
% -- check if f is the same 
% ===========================================================================================================================================================================================================================
%% Test: f
load('Old_1_ref.mat','f'); of = f;
load('New_Reference.mat','f'); nf = f;

clearvars f

problem = 0;
for o = 1:25
    for p = 1:287
        A = of(:,:,o,p);
        B = nf(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end

    end
end


assert(problem==0,'f Test: FAIL')



% ===========================================================================================================================================================================================================================
% -- check if Uei is the same 
% ===========================================================================================================================================================================================================================
%% Test: Uei
load('Old_1_ref.mat','Uei'); oUei = Uei;
load('New_Reference.mat','Uei'); nUei = Uei;

clearvars Uei

problem = 0;
for o = 1:25
    for p = 1:287
        A = oUei(:,:,o,p);
        B = nUei(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end

    end
end


assert(problem==0,'Uei Test: FAIL')




% ===========================================================================================================================================================================================================================
% -- check if Uer is the same 
% ===========================================================================================================================================================================================================================
%% Test: Uer
load('Old_1_ref.mat','Uer'); oUer = Uer;
load('New_Reference.mat','Uer'); nUer = Uer;

clearvars dely

problem = 0;
for o = 1:25
    for p = 1:287
        A = oUer(:,:,o,p);
        B = nUer(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end
    end
end


assert(problem==0,'Uer Test: FAIL')



% ===========================================================================================================================================================================================================================
% -- check if waveang is the same 
% ===========================================================================================================================================================================================================================
%% Test: waveang
load('Old_1_ref.mat','waveang'); owaveang = waveang;
load('New_Reference.mat','waveang'); nwaveang = waveang; 

clearvars waveang

problem = 0;
for o = 1:25
    for p = 1:287
        A = owaveang(:,:,o,p);
        B = nwaveang(:,:,o,p);
        Index{o,p} = find(A~=B);
        if ~isempty(Index{o,p})
            problem = problem + 1;
        end

    end
end


assert(problem==0,'waveang Test: FAIL')


% ==============
% -- check if dthd is same
% ===========
%% Test: dthd
load('Old_1_ref.mat','dthd'); odthd = dthd;
load('New_Reference.mat','dthd'); ndthd = dthd; 

assert(isequaln(odthd,ndthd),'dthd test: FAIL')

% ==============
% -- check if dthd is same
% ===========
%% Test: dr
load('Old_1_ref.mat','dr'); odr = dr;
load('New_Reference.mat','dr'); ndr = dr; 

assert(isequaln(odr,ndr),'dr test: FAIL')


clearvars -except xplot yplot m n passTest numTest
% % ===========================================================================================================================================================================================================================
% % ===========================================================================================================================================================================================================================
% 
% % report pass rate
% passRate = (passTest/numTest)*100;
% fprintf('%.2f percent of tests passed\n',passRate)
% disp('testing_changes_ref.m completed')

% ===========================================================================================================================================================================================================================
% ===========================================================================================================================================================================================================================